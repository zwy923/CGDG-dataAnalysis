# 电力收益分析系统

这是一个用于分析电力现货交易数据的综合系统，包含日前结算收益分析和原合约优化分析两大功能模块。

## 功能概述

### 1. 日前结算收益分析器
- 分析Excel文件中的日前结算收益负值
- 支持按日、月、年查询
- 提供详细的数据汇总和统计

### 2. 原合约优化分析器（新增功能）
- 分析"统计图"表中的数据
- 优化原合约使总收入最大
- 生成每日96个时间点的最优原合约曲线
- 计算月度平均原合约曲线
- 提供可视化图表分析

## 系统要求

- Python 3.7+
- Windows 10/11

## 安装依赖

运行以下命令安装所需的Python包：

```bash
pip install -r requirements.txt
```

或者双击运行 `启动.bat` 文件，选择选项3进行安装。

## 使用方法

### 方法1：使用启动脚本（推荐）

双击运行 `启动.bat` 文件，然后选择要运行的程序：

1. **日前结算收益分析器** - 分析日前结算收益数据
2. **原合约优化分析器** - 分析原合约优化
3. **安装依赖包** - 安装所需的Python包

### 方法2：直接运行Python脚本

```bash
# 运行日前结算收益分析器
python interactive_analyzer.py

# 运行原合约优化分析器
python contract_optimizer.py
```

## 原合约优化分析功能详解

### 核心概念

根据您的要求，系统实现了以下优化逻辑：

1. **原合约取值范围**：(0, 12)
2. **总收入计算公式**：总收入 = 原合约 × 合约电价 - 原合约 × 日前电价
3. **约束条件**：
   - 每日原合约总量不超过用户设定的限制值（如5月每天451.527）
   - 每个时间点的原合约值在(0, 12)范围内
4. **优化策略**：
   - 使用线性规划算法在约束条件下最大化总收益
   - 优先分配给收益最高的时间点
   - 当线性规划失败时，使用贪心算法作为备选方案

### 功能特性

#### 1. 单日分析
- 用户输入每日原合约总量限制
- 分析指定日期的96个时间点（每15分钟一个点）
- 在总量约束下计算每个时间点的最优原合约值
- 生成最优收益曲线和约束满足情况
- 提供价格差分析和优化算法信息
- 显示原合约分布统计

#### 2. 月度分析
- 用户输入月度每日原合约总量限制
- 计算指定月份所有日期的优化原合约值
- 生成月度平均原合约曲线（在约束条件下）
- 提供标准差区间显示和约束满足统计
- 统计月度原合约分布和总量控制情况

#### 3. 可视化图表
- **每日分析图表**：包含4个子图
  - 最优原合约曲线（显示总量限制信息）
  - 最优收益曲线（显示总收益）
  - 价格差分布（合约电价 - 日前电价）
  - 原合约分布直方图

- **月度分析图表**：包含2个子图
  - 月度平均原合约曲线（含标准差区间和总量限制信息）
  - 月度原合约分布直方图

### 数据要求

Excel文件需要包含以下工作表：
- **统计图** - 包含分析所需的所有数据

统计图表中需要包含以下列（列名包含关键词即可）：
- 合约电价
- 日前电价
- 撮合电价（可选）
- 实时电价（可选）
- 省间现货电价（可选）

## 文件结构

```
日结结算收益/
├── interactive_analyzer.py    # 日前结算收益分析器
├── contract_optimizer.py      # 原合约优化分析器
├── power_analyzer.py          # 核心分析模块
├── requirements.txt           # 依赖包列表
├── 启动.bat                   # 启动脚本
├── README.md                  # 说明文档
└── *.xlsx                     # Excel数据文件
```

## 使用示例

### 示例1：分析单日原合约优化

1. 运行 `启动.bat`
2. 选择选项2（原合约优化分析器）
3. 选择选项1（分析单日原合约优化）
4. 输入日期：`2025-05-10`
5. 输入每日总量限制：`451.527`
6. 系统自动进行约束优化分析
7. 查看分析结果和图表

### 示例2：分析月度原合约优化

1. 运行 `启动.bat`
2. 选择选项2（原合约优化分析器）
3. 选择选项2（分析月度原合约优化）
4. 输入月份：`2025-05`
5. 输入每日总量限制：`451.527`
6. 系统分析该月所有日期的优化结果
7. 查看月度分析结果和统计图表

## 注意事项

1. **数据格式**：确保Excel文件包含"统计图"工作表
2. **列名匹配**：系统会自动查找包含关键词的列名
3. **数据质量**：确保电价数据为数值格式
4. **文件命名**：Excel文件名应包含日期信息（如：2025年大市风电场现货交易日报(5月10日).xlsx）

## 技术支持

如果遇到问题，请检查：
1. Python环境是否正确安装
2. 依赖包是否完整安装
3. Excel文件格式是否正确
4. 数据列名是否包含必要关键词

## 更新日志

### v2.0.0 (2025-01-XX)
- 新增原合约优化分析功能
- 添加可视化图表功能
- 支持月度统计分析
- 优化用户界面

### v1.0.0 (2025-01-XX)
- 基础日前结算收益分析功能
- 支持按日、月、年查询
- 提供数据汇总功能 